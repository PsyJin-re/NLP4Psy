## 功能
连续获取一个或多个**微博关键词搜索**结果，并将结果写入csv文件。所谓微博关键词搜索即：**搜索正文中包含指定关键词的微博**，可以指定搜索的时间范围。<br>
举个栗子，比如你可以搜索包含关键词“迪丽热巴”且发布日期在2024-06-01和2024-06-15之间的微博。搜索结果数量巨大，对于非常热门的关键词，在一天的指定时间范围，可以获得**1000万**以上的搜索结果。注意这里的一天指的是时间筛选范围，具体多长时间将这1000万微博下载到本地还要看获取的速度。1000万只是一天时间范围可获取的微博数量，如果想获取更多微博，可以加大时间范围，比如10天，最多可以获得1000万X10=1亿条搜索结果，当然你也可以再加大时间范围。对于大多数关键词，微博一天产生的相关搜索结果应该低于1000万，因此可以说**本程序可以获取指定关键词的全部或近似全部的搜索结果**。本程序可以获得几乎全部的微博信息，如微博正文、发布者等，详情见[输出](#输出)部分。支持输出多种文件类型，具体如下：

## 输出
- user_id：微博用户id
- 微博发布位置：微博中的发布位置
- 微博id：微博的id，为一串数字形式
- 微博发布时间：微博发布的时间
- 点赞数：微博被赞的数量
- 评论数：微博被评论的数量
- 微博内容：微博正文
- 结果文件：保存在当前目录“结果文件”文件夹下以关键词为名的文件夹里


## 使用说明
本程序的所有配置都在setting.py文件中完成，该文件位于“weibo-search-master\weibo\settings.py”。

### 1.安装Scrapy
本程序依赖Scrapy，要想运行程序，需要安装Scrapy。如果系统中没有安装Scrapy，请根据自己的系统安装Scrapy，可以使用如下命令：
```bash
$ pip install scrapy
```
### 2.安装依赖
```
$ pip install -r requirements.txt
```
### 3.修改setting.py文件夹中的参数
### 3.1设置cookie
DEFAULT_REQUEST_HEADERS中的cookie是我们需要填的值，如何获取cookie详见[如何获取cookie](#如何获取cookie)，获取后将"your cookie"替换成真实的cookie即可。

### 3.2设置搜索关键词
修改KEYWORD_LIST参数。
如果你想搜索一个关键词，如“迪丽热巴”：
```
KEYWORD_LIST = ['迪丽热巴']
```
如果你想分别搜索多个关键词，如想要分别获得“迪丽热巴”和“杨幂”的搜索结果：
```
KEYWORD_LIST = ['迪丽热巴', '杨幂']
```
如果你想搜索同时包含多个关键词的微博，如同时包含“迪丽热巴”和“杨幂”微博的搜索结果：
```
KEYWORD_LIST = ['迪丽热巴 杨幂']
```
也可以把关键词写进txt文件里，然后将txt文件路径赋值给KEYWORD_LIST，如：
```
KEYWORD_LIST = 'keyword_list.txt'
```
txt文件中每个关键词占一行。
### 3.3设置搜索时间范围
START_DATE代表搜索的起始日期，END_DATE代表搜索的结束日期，值为“yyyy-mm-dd”形式，程序会搜索包含关键词且发布时间在起始日期和结束日期之间的微博（包含边界）。比如我想筛选发布时间在2020-06-01到2020-06-02这两天的微博：
```
START_DATE = '2020-06-01'
END_DATE = '2020-06-02'
```
### 3.4筛选微博发布地区（可选）
REGION筛选微博的发布地区，精确到省或直辖市，值不应包含“省”或“市”等字，如想筛选北京市的微博请用“北京”而不是“北京市”，想要筛选安徽省的微博请用“安徽”而不是“安徽省”，可以写多个地区，具体支持的地名见region.py文件，注意只支持省或直辖市的名字，省下面的市名及直辖市下面的区县名不支持，不筛选请用”全部“。比如我想要筛选发布地在山东省的微博：
```
REGION = ['山东']
```

### 4.运行程序
```bash
$ scrapy crawl search -s JOBDIR=crawls/search
```
其实只运行“scrapy crawl search”也可以，只是上述方式在结束时可以保存进度，下次运行时会在程序上次的地方继续获取。注意，如果想要保存进度，请使用“Ctrl + C”**一次**，注意是**一次**。按下“Ctrl + C”一次后，程序会继续运行一会，主要用来保存获取的数据、保存进度等操作，请耐心等待。下次再运行时，只要再运行上面的指令就可以恢复上次的进度。

## 如何获取cookie
1. 用Chrome打开 https://weibo.com/
2. 点击"立即登录", 完成私信验证或手机验证码验证, 进入新版微博. 
3. 按F12打开开发者工具, 在开发者工具的 Network->Name->weibo.cn->Headers->Request Headers, 找到"Cookie:"后的值, 这就是我们要找的cookie值, 复制即可, 如图所示:
   ![img.png](./weibo-search-master/img.png)


